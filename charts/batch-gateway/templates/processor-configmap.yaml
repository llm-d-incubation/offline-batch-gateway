{{- if .Values.processor.enabled -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "batch-gateway.processor.fullname" . }}-config
  labels:
    {{- include "batch-gateway.processor.labels" . | nindent 4 }}
data:
  config.yaml: |
    # Processor configuration
    # NOTE: This is a placeholder - processor is not code-ready yet

    addr: {{ .Values.processor.config.addr | quote }}
    task_wait_time: {{ .Values.processor.config.taskWaitTime | quote }}
    poll_interval: {{ .Values.processor.config.pollInterval | quote }}
    num_workers: {{ .Values.processor.config.numWorkers }}
    max_job_concurrency: {{ .Values.processor.config.maxJobConcurrency }}

    queue_time_bucket:
      bucket_start: {{ .Values.processor.config.queueTimeBucket.bucketStart }}
      bucket_factor: {{ .Values.processor.config.queueTimeBucket.bucketFactor }}
      bucket_count: {{ .Values.processor.config.queueTimeBucket.bucketCount }}

    process_time_bucket:
      bucket_start: {{ .Values.processor.config.processTimeBucket.bucketStart }}
      bucket_factor: {{ .Values.processor.config.processTimeBucket.bucketFactor }}
      bucket_count: {{ .Values.processor.config.processTimeBucket.bucketCount }}

    {{- if .Values.processor.tls.enabled }}
    ssl_cert_file: "/etc/tls/tls.crt"
    ssl_key_file: "/etc/tls/tls.key"
    {{- end }}

    {{- if .Values.processor.database.url }}
    database_url: {{ .Values.processor.database.url | quote }}
    {{- end }}
{{- end }}
